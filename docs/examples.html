<!DOCTYPE html>
<html>
<head>
  <title>Examples | Obj.JS</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel='stylesheet' href='Kempo.css' />
  <script src='jquery-3.1.1.min.js'></script>
  <script src='Kempo.js'></script>
  <script src='Obj.js'></script>
  <style>
    pre {
      max-height: 400px;
    }
  </style>
</head>
<body>
  <kempo-include src='nav.inc.html'></kempo-include>
  <kempo-wrapper>
    <h1 center>Examples</h1>
    <hr>
    <h3>Button</h3>
    <div id='t1'></div>
<pre info="JavaScript" encode>
var Button = Obj.create(function(label, action){
  this.defMember("label", label);
  this.defMember("action", action);
  this.renderer = function(){
    var self = this;
    return $("<button>"+this.label+"</button>").on("click", function(){
      self.action();
    });
  }
});

new Button("Click Me", function(){
  alert("You clicked me");
}).render("#target");
</pre>

    <hr>
    <h3>Editable Text</h3>
    <div id='t2'></div>
<pre encode info="JavaScript">
var EditableText = Obj.create(function(text){
  this.defMember("text", text);
  this.renderer = function(){
    var self = this;
    var $editable = $("<p contenteditable='true' tabindex='0'>" + this.text + "</p>").on("keyup keydown blur", function(){
      self.text = $editable.text();
    });
    return $editable;
  };
  this.refresher = function($element, data){
    if(!$element.is(":focus")){
      return this.renderer();
    } // Do not refresh the element if it is focused.
  };
});

new EditableText("Edit Me").render("#target");
</pre>


    <h5>Synced (reactive) Editeble Text</h5>
    <kempo-layout size ='6' id='t3'></kempo-layout>
    <kempo-layout size ='6' id='t4'></kempo-layout>
<pre info="JavaScript">
// Create a new Editable Text Object
var myEditableText = new EditableText("Edit Me");

// Render two DOM instances of the same object
myEditableText.render("#target1");
myEditableText.render("#target2");
</pre>

    <hr>
    <h3>To Do List</h3>
    <div id='t5'></div>
<pre info='JavaScript'>
var ToDoList = Obj.create(function(){
  var list = this;

  var ToDoItem = Obj.create(function(){
    this.defMember("text");
    this.defMember("done");
    this.renderer = function(){
      var self = this;
      var $item = $("&lt;div class='ToDoItem'>&lt;/div>");
      var $checkbox = $("&lt;input class='ToDoItem-checkbox' type='checkbox' />").on("change", function(){
        self.done = $checkbox.is(":checked");
      }).appendTo($item);
      if(this.done){
        $checkbox.attr("checked", "true");
      }
      var $text = $("&lt;span class='ToDoItem-text' contenteditable='true' tabindex='0'>").on("blur", function(){
        self.text = $text.text();
      }).text(this.text).appendTo($item);
      var $remove = $("&lt;span class='ToDoItem-remove'>X&lt;/span>").on("click", function(){
        for(var i=0; i&lt;list.items.length; i++){
          if(list.items[i] == self){
            list.items.splice(i, 1);
          }
        }
        self.destroy();
      }).appendTo($item);
      return $item;
    };
    this.init = function(text, done){
      this.text = text || "";
      this.done = !!(done);
    };
    this.init.apply(this, arguments);
  });

  this.defMember("items", []);

  this.defMethod("addItem", function(text, done){
    this.items.push(new ToDoItem(text, done));
    this.refresh("items");
  });

  this.renderer = function(){
    var $todo = $("&lt;div class='ToDoList'>&lt;/div>");
    var $items = $("&lt;div class='ToDoList-items'>&lt;/div>").appendTo($todo);
    for(var i=0; i&lt;this.items.length; i++){
      this.items[i].render($items);
    }
    var $input = $("&lt;input placeholder='Add a To Do Item'>")
      .on("blur", function(){
        if($input.val().length > 0){
          list.addItem($input.val());
        }
      })
      .on("keydown", function(e){
        if(e.keyCode == 13 && $input.val().length > 0){
          list.addItem($input.val());
        }
      })
      .appendTo($todo);
    return $todo;
  };

  this.init = function(items){
    if(items){
      this.items = [];
      for(var i=0; i&lt;items.length; i++){
        this.addItem(items[i]);
      }
    }
  };
  this.init.apply(this, arguments);
});

new ToDoList().render("#target");
</pre>
    <style>
      .ToDoList {
        display: block;
        margin: 16px;
        border: 1px solid #999;
      }

      .ToDoItem {
        display: flex;
        margin: 16px;
      }

      .ToDoItem-checkbox {
        flex: none;
      }

      .ToDoItem-text {
        display: inline-block;
        flex: 1;
        line-height: 20px;
        padding: 16px;
      }

      .ToDoItem-remove {
        display: inline-block;
        flex: none;
        line-height: 20px;
        margin: 16px;
        font-size: 20px;
        font-weight: 700;
        cursor: pointer;
      }
    </style>



    <p><br><br><br></p>
    <p><br><br><br></p>
    <script>
      var Button = Obj.create(function(label, action){
        this.defMember("label", label);
        this.defMember("action", action);
        this.renderer = function(){
          var self = this;
          return $("<button>"+this.label+"</button>").on("click", function(){
            self.action();
          });
        }
      });

      new Button("Click Me", function(){
        alert("You clicked me");
      }).render("#t1", "replace");

      var EditableText = Obj.create(function(text){
        this.defMember("text", text);
        this.renderer = function(){
          var self = this;
          var $editable = $("<p contenteditable='true' tabindex='0'>" + this.text + "</p>");
          // On all input include held down keys and pastes
          $editable.on("keyup keydown blur input propertychange", function(){
            self.text = $editable.text();
          });
          return $editable;
        };
        this.refresher = function($element, data){
          if(!$element.is(":focus")){
            return this.renderer();
          } // Do not refresh the element if it is focused.
        };
      });

      new EditableText("Edit Me").render("#t2", "replace");

      var a = new EditableText("Edit Me");
      a.render("#t3", "append");
      a.render("#t4", "append");

      var ToDoList = Obj.create(function(){
        var list = this;

        var ToDoItem = Obj.create(function(){
          this.defMember("text");
          this.defMember("done");
          this.renderer = function(){
            var self = this;
            var $item = $("<div class='ToDoItem'></div>");
            var $checkbox = $("<input class='ToDoItem-checkbox' type='checkbox' />").on("change", function(){
              self.done = $checkbox.is(":checked");
            }).appendTo($item);
            if(this.done){
              $checkbox.attr("checked", "true");
            }
            var $text = $("<span class='ToDoItem-text' contenteditable='true' tabindex='0'>").on("blur", function(){
              self.text = $text.text();
            }).text(this.text).appendTo($item);
            var $remove = $("<span class='ToDoItem-remove'>X</span>").on("click", function(){
              for(var i=0; i<list.items.length; i++){
                if(list.items[i] == self){
                  list.items.splice(i, 1);
                }
              }
              self.destroy();
            }).appendTo($item);
            return $item;
          };
          this.init = function(text, done){
            this.text = text || "";
            this.done = !!(done);
          };
          this.init.apply(this, arguments);
        });

        this.defMember("items", []);

        this.defMethod("addItem", function(text, done){
          this.items.push(new ToDoItem(text, done));
          this.refresh("items");
        });

        this.renderer = function(){
          var $todo = $("<div class='ToDoList'></div>");
          var $items = $("<div class='ToDoList-items'></div>").appendTo($todo);
          for(var i=0; i<this.items.length; i++){
            this.items[i].render($items);
          }
          var $input = $("<input placeholder='Add a To Do Item'>")
            .on("blur", function(){
              if($input.val().length > 0){
                list.addItem($input.val());
              }
            })
            .on("keydown", function(e){
              if(e.keyCode == 13 && $input.val().length > 0){
                list.addItem($input.val());
              }
            })
            .appendTo($todo);
          return $todo;
        };

        this.init = function(items){
          if(items){
            this.items = [];
            for(var i=0; i<items.length; i++){
              this.addItem(items[i]);
            }
          }
        };
        this.init.apply(this, arguments);
      });

      new ToDoList().render("#t5", "replace");
    </script>
  </kempo-wrapper>
</body>
</html>
